---
title: "Geospatial Visualizations"
author: "Darshan Sumant"
date: "February 10, 2019"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    code_folding: hide
---

```{r setup, include=FALSE}

# Load required packages
library("rmarkdown")
library("readr")
library("haven")
library("plyr")
library("dplyr")
library("tidyr")
library("stringr")
library("ggplot2")
library("zoo")
library("lubridate")
library("directlabels")
library("wesanderson")
library("ggmap")
library("maps")
library("mapdata")
library("openintro")
library("grid")
library("tools")
library("maptools")
library("lwgeom")

# library(c("cowplot", "googleway", "ggrepel", "ggspatial", "libwgeom", "sf", "rnaturalearth", "rnaturalearthdata"))
library("rgeos")
library("cowplot")
library("googleway")
library("ggrepel")
library("ggspatial")
library("sf")
library("rnaturalearth")
library("rnaturalearthdata")

register_google(key = "AIzaSyCvTsf9fTcIeH9d7WkTVxvYQzu80Hs-EvQ")

knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
```

```{r Philly_Shapefiles}

# Use ggmap to get Philly maptile
ph_map <- get_map(location = "Philadelphia County, Pennsylvania", zoom = 12)

# Load Parcel-level Shapefile
phl_parcels <- read_sf("datasets/Philly_parcels/DOR_Parcel.shp")
summary(phl_parcels)

# Load City Council Districts Shapefile
phl_dist <- read_sf("datasets/Philly_Council_Districts_2016/Council_Districts_2016.shp")
summary(phl_dist)

# Calculate District Centroids
phl_dist <- cbind(phl_dist, st_coordinates(st_centroid(phl_dist)))

# Nudge Centroid Labels on Y-axis
phl_dist$nudge_y <- 0
phl_dist$nudge_y[phl_dist$OBJECTID == 9] <- -1.0
phl_dist$nudge_y[phl_dist$OBJECTID == 10] <- -0.5

# Nudge Centroid Labels on X-axis
phl_dist$nudge_x <- 0
phl_dist$nudge_x[phl_dist$OBJECTID == 4] <- 0.5
phl_dist$nudge_x[phl_dist$OBJECTID == 2] <- 0.5

```
```{r Map}

# Plot Districts on Top of Geocoded Maptile
ggmap(ph_map) +
  geom_sf(data = phl_dist, inherit.aes = FALSE, 
          fill=NA, color=gray(0.5)) +
  coord_sf(datum = NA) + 
  geom_label(data = phl_dist, inherit.aes = FALSE, 
             aes(X, Y, label = OBJECTID), size = 5, fontface = "bold",
             nudge_y = phl_dist$nudge_y,
             nudge_x = phl_dist$nudge_x)

```